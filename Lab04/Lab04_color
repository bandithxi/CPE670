#ifndef __LAB04_COLOR_NXC__
#define __LAB04_COLOR_NXC__


#define COLOR_SENSOR IN_3

#define HOME_BLACK 4
#define FEILD_WHITE 13


// we might be able to use RGB values to somehow compensate for poor
// color number results
typedef struct {
  byte colorNum;
  byte red;
  byte green;
  byte blue;
} ColorVal;


mutex gColorMutex;
ColorVal gColorReading;


/**
 *
 */
task TASK_colorSensor() {

  while (true) {
    Acquire(gColorMutex);

    bool readSuccess = ReadSensorHTColor(
      COLOR_SENSOR,
      gColorReading.colorNum,
      gColorReading.red,
      gColorReading.green,
      gColorReading.blue
    );
    Wait(MS_50);

    if (gColorReading.colorNum != HOME_BLACK && gColorReading.colorNum != FEILD_WHITE) {
      PlayTone(TONE_A5, MS_250);
    }

    Release(gColorMutex);
  }
}

#endif //__LAB04_COLOR_NXC__